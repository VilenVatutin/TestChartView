package com.example.testchartview

import android.content.pm.ActivityInfo
import android.content.res.Resources
import android.graphics.Paint
import android.os.Bundle
import android.util.TypedValue
import android.view.View
import android.widget.RelativeLayout
import android.widget.TextView
import androidx.appcompat.app.AppCompatActivity
import androidx.core.view.marginTop
import com.example.testchartview.chart_view.ChartView
import com.example.chart.chart_view.data.InputData
import com.example.testchartview.chart_view.OnPointChosenLitener
import java.util.concurrent.TimeUnit


class MainActivity : AppCompatActivity() {

    lateinit var chart: ChartView

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        chart = findViewById(R.id.chart)
        val rl = findViewById<RelativeLayout>(R.id.rl)
        val info = findViewById<TextView>(R.id.info)
        val btnBlue = findViewById<View>(R.id.btnBlue)
        val btnPurple = findViewById<View>(R.id.btnPurple)
        val btnHideFrame = findViewById<TextView>(R.id.btnHideFrame)
        val btnShowFrame = findViewById<TextView>(R.id.btnShowFrame)
        val btnRotate = findViewById<TextView>(R.id.btnRotate)
        btnHideFrame.setOnClickListener {
            chart.hideFrame()
        }

        btnShowFrame.setOnClickListener {
            chart.showFrame()
        }
        btnRotate.setOnClickListener {
            requestedOrientation =
                if (requestedOrientation == ActivityInfo.SCREEN_ORIENTATION_PORTRAIT) ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE
                else ActivityInfo.SCREEN_ORIENTATION_PORTRAIT
        }

        btnBlue.setOnClickListener {
            chart.setLineColor(resources.getColor(R.color.blue))
            chart.setLineWidth(resources.getDimension(R.dimen.line_width))
            chart.setData(createSPData())
        }
        btnPurple.setOnClickListener {
            chart.setLineColor(resources.getColor(R.color.purple_200))
            chart.setLineWidth(resources.getDimension(R.dimen.line_width))
            chart.setData(createPurpleChartData())
        }

        chart.setOnPointChosenListener(object : OnPointChosenLitener {
            override fun onPointChosen(paddingLeft: Int, paddinTop: Int, sInfo: String) {
                val params = RelativeLayout.LayoutParams(rl.layoutParams)
                params.leftMargin = paddingLeft - info.width / 2 + getPx(8)
                params.topMargin = paddinTop - info.height - getPx(10) + chart.marginTop
                rl.layoutParams = params
                rl.visibility = View.VISIBLE
                info.text = sInfo
            }

            override fun hideDialog() {
                rl.visibility = View.GONE
            }
        })

    }

    override fun onDestroy() {
        super.onDestroy()
        chart.removeOnPointChosenListener()
    }

    fun getPx(dp: Int): Int {
        return TypedValue.applyDimension(
            TypedValue.COMPLEX_UNIT_DIP,
            dp.toFloat(),
            resources.displayMetrics
        ).toInt()
    }

    private fun createPurpleChartData(): List<InputData> {
        val dataList: MutableList<InputData> = ArrayList<InputData>()
        dataList.add(InputData(1314.99, "07.06.2012"))
        dataList.add(InputData(1325.66, "08.06.2012"))
        dataList.add(InputData(1308.93, "11.06.2012"))
        dataList.add(InputData(1324.18, "12.06.2012"))
        dataList.add(InputData(1314.88, "13.06.2012"))
        dataList.add(InputData(132.1,"14.06.2012"))
        dataList.add(InputData(1342.84, "15.06.2012"))
        dataList.add(InputData(1344.78, "18.06.2012"))
        dataList.add(InputData(1357.98, "19.06.2012"))
        dataList.add(InputData(1355.69, "20.06.2012"))
        dataList.add(InputData(1325.51, "21.06.2012"))
        dataList.add(InputData(1335.02, "22.06.2012"))
        dataList.add(InputData(1313.72, "25.06.2012"))
        dataList.add(InputData(1319.99, "26.06.2012"))
        dataList.add(InputData(1331.85, "27.06.2012"))
        dataList.add(InputData(1329.04, "28.06.2012"))
        dataList.add(InputData(1362.16, "29.06.2012"))
        dataList.add(InputData(1365.51, "02.07.2012"))
        dataList.add(InputData(1374.02, "03.07.2012"))
        dataList.add(InputData(1367.58, "05.07.2012"))
        dataList.add(InputData(1354.68, "06.07.2012"))
        dataList.add(InputData(1352.46, "09.07.2012"))
        dataList.add(InputData(1341.47, "10.07.2012"))
        dataList.add(InputData(1341.45, "11.07.2012"))
        dataList.add(InputData(1334.76, "12.07.2012"))
        dataList.add(InputData(1356.78, "13.07.2012"))
        dataList.add(InputData(1353.64, "16.07.2012"))
        dataList.add(InputData(1363.67, "17.07.2012"))
        dataList.add(InputData(1372.78, "18.07.2012"))
        dataList.add(InputData(1376.51, "19.07.2012"))
        dataList.add(InputData(1362.66, "20.07.2012"))
        dataList.add(InputData(1350.52, "23.07.2012"))
        dataList.add(InputData(1338.31, "24.07.2012"))
        dataList.add(InputData(1337.89, "25.07.2012"))
        dataList.add(InputData(1360.02, "26.07.2012"))
        dataList.add(InputData(1385.97, "27.07.2012"))
        dataList.add(InputData(138.3,"30.07.2012"))
        dataList.add(InputData(1379.3, "31.07.2012"))
        dataList.add(InputData(1375.14, "01.08.2012"))
        dataList.add(InputData(.365,"02.08.2012"))
        dataList.add(InputData(1390.99, "03.08.2012"))
        dataList.add(InputData(1394.2, "06.08.2012"))
        dataList.add(InputData(1401.35, "07.08.2012"))
        dataList.add(InputData(1402.22, "08.08.2012"))
        dataList.add(InputData(140.8,"09.08.2012"))
        dataList.add(InputData(1405.87, "10.08.2012"))
        dataList.add(InputData(1404.11, "13.08.2012"))
        dataList.add(InputData(1403.93, "14.08.2012"))
        dataList.add(InputData(1405.53, "15.08.2012"))
        dataList.add(InputData(1415.51, "16.08.2012"))
        dataList.add(InputData(1418.16, "17.08.2012"))
        dataList.add(InputData(1418.13, "20.08.2012"))
        dataList.add(InputData(1413.17, "21.08.2012"))
        dataList.add(InputData(1413.49, "22.08.2012"))
        dataList.add(InputData(1402.08, "23.08.2012"))
        dataList.add(InputData(1411.13, "24.08.2012"))
        dataList.add(InputData(1410.44, "27.08.2012"))
        dataList.add(InputData(140.03,"28.08.2012"))
        dataList.add(InputData(1410.49, "29.08.2012"))
        dataList.add(InputData(1399.48, "30.08.2012"))
        dataList.add(InputData(1406.58, "31.08.2012"))
        dataList.add(InputData(1404.94, "04.09.2012"))
        dataList.add(InputData(1403.44, "05.09.2012"))
        dataList.add(InputData(143.12, "06.09.201"))
        return dataList
    }


    private fun createSPData(): List<InputData> {
        val dataList: MutableList<InputData> = ArrayList<InputData>()
        dataList.add(InputData(1365.68, "29.02.2012"))
        dataList.add(InputData(1374.09, "01.03.2012"))
        dataList.add(InputData(1369.63, "02.03.2012"))
        dataList.add(InputData(1364.33, "05.03.2012"))
        dataList.add(InputData(1343.36, "06.03.2012"))
        dataList.add(InputData(1352.63, "07.03.2012"))
        dataList.add(InputData(1365.91, "08.03.2012"))
        dataList.add(InputData(1370.87, "09.03.2012"))
        dataList.add(InputData(1371.09, "12.03.2012"))
        dataList.add(InputData(1395.95, "13.03.2012"))
        dataList.add(InputData(1394.28, "14.03.2012"))
        dataList.add(InputData(1402.6, "15.03.2012"))
        dataList.add(InputData(1404.17, "16.03.2012"))
        dataList.add(InputData(1409.75, "19.03.2012"))
        dataList.add(InputData(1405.52, "20.03.2012"))
        dataList.add(InputData(1402.89, "21.03.2012"))
        dataList.add(InputData(1392.78, "22.03.2012"))
        dataList.add(InputData(1397.11, "23.03.2012"))
        dataList.add(InputData(1416.51, "26.03.2012"))
        dataList.add(InputData(1412.52, "27.03.2012"))
        dataList.add(InputData(1405.54, "28.03.2012"))
        dataList.add(InputData(1403.28, "29.03.2012"))
        dataList.add(InputData(1408.47, "30.03.2012"))
        dataList.add(InputData(1419.04, "02.04.2012"))
        dataList.add(InputData(1413.38, "03.04.2012"))
        dataList.add(InputData(1398.96, "04.04.2012"))
        dataList.add(InputData(1398.08, "05.04.2012"))
        dataList.add(InputData(1382.2, "09.04.2012"))
        dataList.add(InputData(1358.59, "10.04.2012"))
        dataList.add(InputData(1368.71, "11.04.2012"))
        dataList.add(InputData(1387.57, "12.04.2012"))
        dataList.add(InputData(1370.26, "13.04.2012"))
        dataList.add(InputData(1369.57, "16.04.2012"))
        dataList.add(InputData(1390.78, "17.04.2012"))
        dataList.add(InputData(1385.14, "18.04.2012"))
        dataList.add(InputData(1376.92, "19.04.2012"))
        dataList.add(InputData(1378.53, "20.04.2012"))
        dataList.add(InputData(1366.94, "23.04.2012"))
        dataList.add(InputData(1371.97, "24.04.2012"))
        dataList.add(InputData(1390.69, "25.04.2012"))
        dataList.add(InputData(1399.98, "26.04.2012"))
        dataList.add(InputData(1403.36, "27.04.2012"))
        dataList.add(InputData(1397.91, "30.04.2012"))
        dataList.add(InputData(1405.82, "01.05.2012"))
        dataList.add(InputData(1402.31, "02.05.2012"))
        dataList.add(InputData(1391.57, "03.05.2012"))
        dataList.add(InputData(1369.1, "04.05.2012"))
        dataList.add(InputData(1369.58, "07.05.2012"))
        dataList.add(InputData(1363.72, "08.05.2012"))
        dataList.add(InputData(1354.58, "09.05.2012"))
        dataList.add(InputData(1357.99, "10.05.2012"))
        dataList.add(InputData(1353.39, "11.05.2012"))
        dataList.add(InputData(1338.35, "14.05.2012"))
        dataList.add(InputData(1330.66, "15.05.2012"))
        dataList.add(InputData(1324.8, "16.05.2012"))
        dataList.add(InputData(1304.86, "17.05.2012"))
        dataList.add(InputData(1295.22, "18.05.2012"))
        dataList.add(InputData(1315.99, "21.05.2012"))
        dataList.add(InputData(1316.63, "22.05.2012"))
        dataList.add(InputData(1318.86, "23.05.2012"))
        dataList.add(InputData(1320.68, "24.05.2012"))
        dataList.add(InputData(1317.82, "25.05.2012"))
        dataList.add(InputData(1332.42, "29.05.2012"))
        dataList.add(InputData(1313.32, "30.05.2012"))
        dataList.add(InputData(1310.33, "31.05.2012"))
        dataList.add(InputData(1278.04, "01.06.2012"))
        dataList.add(InputData(1278.18, "04.06.2012"))
        dataList.add(InputData(1285.5, "05.06.2012"))
        dataList.add(InputData(1315.13, "06.06.201"))
        return dataList
    }

//    private fun createBlueChartData(): List<InputData> {
//        val dataList: MutableList<InputData> = ArrayList<InputData>()
//        dataList.add(InputData(1))
//        dataList.add(InputData(2))
//        dataList.add(InputData(3))
//        dataList.add(InputData(4))
//        dataList.add(InputData(5))
//        dataList.add(InputData(6))
//        dataList.add(InputData(7))
//        dataList.add(InputData(8))
//        dataList.add(InputData(9))
//        dataList.add(InputData(10))
//        dataList.add(InputData(11))
//        dataList.add(InputData(12))
//        dataList.add(InputData(11))
//        dataList.add(InputData(10))
//        dataList.add(InputData(9))
//        dataList.add(InputData(8))
//        dataList.add(InputData(7))
//        dataList.add(InputData(6))
//        dataList.add(InputData(5))
//        dataList.add(InputData(4))
//        dataList.add(InputData(3))
//        dataList.add(InputData(2))
//        dataList.add(InputData(1))
//        dataList.add(InputData(2))
//        dataList.add(InputData(3))
//        dataList.add(InputData(4))
//        dataList.add(InputData(5))
//        dataList.add(InputData(6))
//        dataList.add(InputData(7))
//        dataList.add(InputData(9))
//        dataList.add(InputData(9))
//        dataList.add(InputData(10))
//        dataList.add(InputData(11))
//        dataList.add(InputData(12))
//        dataList.add(InputData(11))
//        dataList.add(InputData(10))
//        dataList.add(InputData(9))
//        dataList.add(InputData(8))
//        dataList.add(InputData(7))
//        dataList.add(InputData(6))
//        dataList.add(InputData(5))
//        dataList.add(InputData(4))
//        dataList.add(InputData(3))
//        dataList.add(InputData(2))
//        dataList.add(InputData(1))
//        dataList.add(InputData(2))
//        dataList.add(InputData(3))
//        dataList.add(InputData(4))
//        dataList.add(InputData(20))
//        dataList.add(InputData(6))
//        dataList.add(InputData(7))
//        dataList.add(InputData(200))
//        dataList.add(InputData(9))
//        dataList.add(InputData(10))
//        dataList.add(InputData(11))
//        dataList.add(InputData(12))
//        dataList.add(InputData(11))
//        dataList.add(InputData(10))
//        dataList.add(InputData(9))
//        dataList.add(InputData(8))
//        dataList.add(InputData(7))
//        dataList.add(InputData(6))
//        dataList.add(InputData(5))
//        dataList.add(InputData(4))
//        dataList.add(InputData(3))
//        dataList.add(InputData(2))
//        dataList.add(InputData(1))
//        dataList.add(InputData(2))
//        dataList.add(InputData(3))
//        dataList.add(InputData(4))
//        dataList.add(InputData(5))
//        dataList.add(InputData(6))
//        dataList.add(InputData(7))
//        dataList.add(InputData(20))
//        dataList.add(InputData(9))
//        dataList.add(InputData(10))
//        dataList.add(InputData(11))
//        dataList.add(InputData(12))
//        dataList.add(InputData(11))
//        dataList.add(InputData(10))
//        dataList.add(InputData(9))
//        dataList.add(InputData(8))
//        dataList.add(InputData(7))
//        dataList.add(InputData(6))
//        dataList.add(InputData(5))
//        dataList.add(InputData(4))
//        dataList.add(InputData(3))
//        dataList.add(InputData(2))
//        dataList.add(InputData(1))
//        dataList.add(InputData(2))
//        dataList.add(InputData(3))
//        dataList.add(InputData(4))
//        dataList.add(InputData(5))
//        dataList.add(InputData(6))
//        dataList.add(InputData(7))
//        dataList.add(InputData(20))
//        dataList.add(InputData(9))
//        dataList.add(InputData(10))
//        dataList.add(InputData(11))
//        dataList.add(InputData(12))
//        dataList.add(InputData(11))
//        dataList.add(InputData(10))
//        dataList.add(InputData(9))
//        dataList.add(InputData(8))
//        dataList.add(InputData(7))
//        dataList.add(InputData(6))
//        dataList.add(InputData(5))
//        dataList.add(InputData(4))
//        dataList.add(InputData(3))
//        dataList.add(InputData(2))
//        dataList.add(InputData(1))
//        dataList.add(InputData(2))
//        dataList.add(InputData(3))
//        dataList.add(InputData(4))
//        dataList.add(InputData(5))
//        dataList.add(InputData(6))
//        dataList.add(InputData(7))
//        dataList.add(InputData(20))
//        dataList.add(InputData(9))
//        dataList.add(InputData(10))
//        dataList.add(InputData(11))
//        dataList.add(InputData(12))
//        dataList.add(InputData(11))
//        dataList.add(InputData(10))
//        dataList.add(InputData(9))
//        dataList.add(InputData(8))
//        dataList.add(InputData(7))
//        dataList.add(InputData(6))
//        dataList.add(InputData(5))
//        dataList.add(InputData(4))
//        dataList.add(InputData(3))
//        dataList.add(InputData(2))
//        dataList.add(InputData(1))
//        dataList.add(InputData(2))
//        dataList.add(InputData(3))
//        dataList.add(InputData(4))
//        dataList.add(InputData(5))
//        dataList.add(InputData(6))
//        dataList.add(InputData(7))
//        dataList.add(InputData(20))
//        dataList.add(InputData(9))
//        dataList.add(InputData(10))
//        dataList.add(InputData(11))
//        dataList.add(InputData(12))
//        dataList.add(InputData(11))
//        dataList.add(InputData(10))
//        dataList.add(InputData(9))
//        dataList.add(InputData(8))
//        dataList.add(InputData(7))
//        dataList.add(InputData(6))
//        dataList.add(InputData(5))
//        dataList.add(InputData(4))
//        dataList.add(InputData(3))
//        dataList.add(InputData(2))
//        dataList.add(InputData(1))
//        dataList.add(InputData(2))
//        dataList.add(InputData(3))
//        dataList.add(InputData(4))
//        dataList.add(InputData(5))
//        dataList.add(InputData(6))
//        dataList.add(InputData(7))
//        dataList.add(InputData(20))
//        dataList.add(InputData(9))
//        dataList.add(InputData(10))
//        dataList.add(InputData(11))
//        dataList.add(InputData(12))
//        dataList.add(InputData(11))
//        dataList.add(InputData(10))
//        dataList.add(InputData(9))
//        dataList.add(InputData(8))
//        dataList.add(InputData(7))
//        dataList.add(InputData(6))
//        dataList.add(InputData(5))
//        dataList.add(InputData(4))
//        dataList.add(InputData(3))
//        dataList.add(InputData(2))
//        dataList.add(InputData(1))
//        dataList.add(InputData(2))
//        dataList.add(InputData(3))
//        dataList.add(InputData(4))
//        dataList.add(InputData(5))
//        dataList.add(InputData(6))
//        dataList.add(InputData(7))
//        dataList.add(InputData(20))
//        dataList.add(InputData(9))
//        dataList.add(InputData(10))
//        dataList.add(InputData(11))
//        dataList.add(InputData(12))
//        dataList.add(InputData(11))
//        dataList.add(InputData(10))
//        dataList.add(InputData(9))
//        dataList.add(InputData(8))
//        dataList.add(InputData(7))
//        dataList.add(InputData(6))
//        dataList.add(InputData(5))
//        dataList.add(InputData(4))
//        dataList.add(InputData(3))
//        dataList.add(InputData(2))
//        return dataList
//    }

}